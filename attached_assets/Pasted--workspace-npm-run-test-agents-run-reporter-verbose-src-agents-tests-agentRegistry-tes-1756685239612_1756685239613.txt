~/workspace$ 
npm run test:agents -- --run --reporter=verbose src/agents/__tests__/agentRegistry.test.ts

> envelope-app-backend@1.0.0 test:agents
> vitest run --config vitest.config.agents.ts --run --reporter=verbose src/agents/__tests__/agentRegistry.test.ts


 RUN  v1.6.1 /home/runner/workspace

 ❯ |agents| src/agents/__tests__/agentRegistry.test.ts (12)
   ❯ AgentRegistry (12)
     ❯ Agent Initialization (2)
       × should initialize all required agents
       ✓ should properly assign tools to agents
     ✓ Agent Routing (4)
       ✓ should route budget-related messages to budget coach
       ✓ should route transaction-related messages to transaction analyst
       ✓ should route insight-related messages to insight generator
       ✓ should default to financial advisor for general messages
     ❯ Agent Execution (3)
       ✓ should successfully run an agent with context
       × should handle agent execution errors gracefully
       ✓ should throw error for non-existent agent
     ❯ Agent Capabilities (2)
       × should return correct capabilities for each agent
       ✓ should return empty array for non-existent agent capabilities
     ✓ Agent Metrics (1)
       ✓ should return comprehensive metrics for all agents

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 3 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

 FAIL  |agents| src/agents/__tests__/agentRegistry.test.ts > AgentRegistry > Agent Initialization > should initialize all required agents
AssertionError: expected [ { …(4) }, …(5) ] to have a length of 4 but got 6

- Expected
+ Received

- 4
+ 6

 ❯ src/agents/__tests__/agentRegistry.test.ts:85:44
     83|       expect(agentNames).toContain('budget…
     84|       expect(agentNames).toContain('transa…
     85|       expect(agentRegistry.getAllAgents())…
       |                                            ^
     86|     });
     87| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/3]⎯

 FAIL  |agents| src/agents/__tests__/agentRegistry.test.ts > AgentRegistry > Agent Execution > should handle agent execution errors gracefully
AssertionError: promise resolved "'Mocked response from financial_adviso…'" instead of rejecting

- Expected: 
[Error: rejected promise]

+ Received: 
"Mocked response from financial_advisor: test message"

 ❯ src/agents/__tests__/agentRegistry.test.ts:135:7
    133|       await expect(
    134|         agentRegistry.runAgent('financial_…
    135|       ).rejects.toThrow('Failed to process…
       |       ^
    136|     });
    137| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/3]⎯

 FAIL  |agents| src/agents/__tests__/agentRegistry.test.ts > AgentRegistry > Agent Capabilities > should return correct capabilities for each agent
AssertionError: expected [ 'comprehensive_guidance', …(3) ] to include 'comprehensive_financial_guidance'
 ❯ src/agents/__tests__/agentRegistry.test.ts:148:35
    146|     it('should return correct capabilities…
    147|       const advisorCapabilities = agentReg…
    148|       expect(advisorCapabilities).toContai…
       |                                   ^
    149|       expect(advisorCapabilities).toContai…
    150| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/3]⎯

 Test Files  1 failed (1)
      Tests  3 failed | 9 passed (12)
   Start at  00:06:47
   Duration  738ms (transform 264ms, setup 97ms, collect 246ms, tests 36ms, environment 0ms, prepare 86ms)
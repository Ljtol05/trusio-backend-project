~/workspace$ npm run test:agents -- --run --reporter=verbose src/agents/__tests__/security.test.ts

> envelope-app-backend@1.0.0 test:agents
> vitest run --config vitest.config.agents.ts --run --reporter=verbose src/agents/__tests__/security.test.ts


 RUN  v1.6.1 /home/runner/workspace

 ❯ |agents| src/agents/__tests__/security.test.ts (15)
   ❯ Security Middleware (15)
     ❯ Input Sanitization (3)
       ✓ should sanitize XSS attempts
       × should sanitize email inputs
       × should sanitize alphanumeric inputs
     ✓ Threat Detection (4)
       ✓ should detect XSS attempts
       ✓ should detect SQL injection attempts
       ✓ should detect path traversal attempts
       ✓ should detect command injection attempts
     ✓ Input Validation (3)
       ✓ should validate and sanitize simple strings
       ✓ should validate complex objects
       ✓ should pass safe inputs
     ✓ Security Middleware Integration (5)
       ✓ should block malicious requests
       ✓ should allow safe requests
       ✓ should sanitize inputs when enabled
       ✓ should enforce rate limiting
       ✓ should add security headers

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 2 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

 FAIL  |agents| src/agents/__tests__/security.test.ts > Security Middleware > Input Sanitization > should sanitize email inputs
AssertionError: expected 'user@domain.comalert(1)' to be 'user@domain.com' // Object.is equality

- Expected
+ Received

- user@domain.com
+ user@domain.comalert(1)

 ❯ src/agents/__tests__/security.test.ts:56:27
     54|       inputs.forEach((input, index) => {
     55|         const sanitized = sanitizeEmail(in…
     56|         expect(sanitized).toBe(expected[in…
       |                           ^
     57|       });
     58|     });
 ❯ src/agents/__tests__/security.test.ts:54:14

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯

 FAIL  |agents| src/agents/__tests__/security.test.ts > Security Middleware > Input Sanitization > should sanitize alphanumeric inputs
AssertionError: expected 'useronclickalert1' not to contain 'onclick'

- Expected
+ Received

- onclick
+ useronclickalert1

 ❯ src/agents/__tests__/security.test.ts:72:31
     70|         expect(sanitized).toMatch(/^[a-zA-…
     71|         expect(sanitized).not.toContain('<…
     72|         expect(sanitized).not.toContain('o…
       |                               ^
     73|         expect(sanitized).not.toContain('D…
     74|         expect(sanitized).not.toContain('`…
 ❯ src/agents/__tests__/security.test.ts:68:23

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯

 Test Files  1 failed (1)
      Tests  2 failed | 13 passed (15)
   Start at  01:21:12
   Duration  1.18s (transform 214ms, setup 117ms, collect 239ms, tests 165ms, environment 0ms, prepare 247ms
~/workspace$ npm run test:agents -- --run --reporter=verbose src/agents/__tests__/validation.test.ts

> envelope-app-backend@1.0.0 test:agents
> vitest run --config vitest.config.agents.ts --run --reporter=verbose src/agents/__tests__/validation.test.ts


 RUN  v1.6.1 /home/runner/workspace

 ❯ |agents| src/agents/__tests__/validation.test.ts (20)
   ❯ Data Validation Tests (20)
     ❯ Schema Validation (7)
       ❯ AgentConfigSchema (2)
         × should validate correct agent configuration
         ✓ should reject invalid agent configuration
       ✓ FinancialContextSchema (3)
         ✓ should validate correct financial context
         ✓ should accept minimal financial context
         ✓ should reject invalid financial context
       ✓ AgentResponseSchema (2)
         ✓ should validate correct agent response
         ✓ should reject invalid agent response
     ❯ Tool Parameter Validation (2)
       ✓ should validate budget analysis parameters
       × should reject invalid tool parameters
     ❯ Error Handling Validation (3)
       × should handle database validation errors gracefully
       ✓ should validate agent handoff parameters
       × should reject invalid handoff parameters
     ❯ Input Sanitization (3)
       ✓ should sanitize user input messages
       ✓ should handle SQL injection attempts in parameters
       × should validate envelope creation with proper limits
     ✓ Type Safety Validation (2)
       ✓ should enforce type safety in agent responses
       ✓ should enforce type safety in financial context
     ❯ Business Logic Validation (3)
       × should validate financial constraints
       × should validate budget constraints
       ✓ should validate date constraints

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 7 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

 FAIL  |agents| src/agents/__tests__/validation.test.ts > Data Validation Tests > Schema Validation > AgentConfigSchema > should validate correct agent configuration
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 ❯ src/agents/__tests__/validation.test.ts:67:32
     65| 
     66|         const result = AgentConfigSchema.s…
     67|         expect(result.success).toBe(true);
       |                                ^
     68|       });
     69| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/7]⎯

 FAIL  |agents| src/agents/__tests__/validation.test.ts > Data Validation Tests > Tool Parameter Validation > should reject invalid tool parameters
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 ❯ src/agents/__tests__/validation.test.ts:226:30
    224| 
    225|       const result = await toolRegistry.ex…
    226|       expect(result.success).toBe(false);
       |                              ^
    227|       expect(result.error).toContain('vali…
    228|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/7]⎯

 FAIL  |agents| src/agents/__tests__/validation.test.ts > Data Validation Tests > Error Handling Validation > should handle database validation errors gracefully
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 ❯ src/agents/__tests__/validation.test.ts:251:30
    249|       );
    250| 
    251|       expect(result.success).toBe(false);
       |                              ^
    252|       expect(result.error).toContain('Vali…
    253|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/7]⎯

 FAIL  |agents| src/agents/__tests__/validation.test.ts > Data Validation Tests > Error Handling Validation > should reject invalid handoff parameters
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 ❯ src/agents/__tests__/validation.test.ts:287:30
    285|       );
    286| 
    287|       expect(result.success).toBe(false);
       |                              ^
    288|       expect(result.error).toContain('vali…
    289|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/7]⎯

 FAIL  |agents| src/agents/__tests__/validation.test.ts > Data Validation Tests > Input Sanitization > should validate envelope creation with proper limits
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 ❯ src/agents/__tests__/validation.test.ts:338:30
    336|       );
    337| 
    338|       expect(result.success).toBe(false);
       |                              ^
    339|       expect(result.error).toContain('vali…
    340|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/7]⎯

 FAIL  |agents| src/agents/__tests__/validation.test.ts > Data Validation Tests > Business Logic Validation > should validate financial constraints
AssertionError: expected 'Tool not found: transfer_funds' to contain 'positive amount'

- Expected
+ Received

- positive amount
+ Tool not found: transfer_funds

 ❯ src/agents/__tests__/validation.test.ts:383:28
    381| 
    382|       expect(result.success).toBe(false);
    383|       expect(result.error).toContain('posi…
       |                            ^
    384|     });
    385| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/7]⎯

 FAIL  |agents| src/agents/__tests__/validation.test.ts > Data Validation Tests > Business Logic Validation > should validate budget constraints
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 ❯ src/agents/__tests__/validation.test.ts:400:30
    398|       );
    399| 
    400|       expect(result.success).toBe(false);
       |                              ^
    401|       expect(result.error).toContain('vali…
    402|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/7]⎯

 Test Files  1 failed (1)
      Tests  7 failed | 13 passed (20)
   Start at  00:44:27
   Duration  829ms (transform 353ms, setup 72ms, collect 237ms, tests 150ms, environment 0ms, prepare 154ms)